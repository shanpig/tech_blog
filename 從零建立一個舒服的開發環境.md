# 從零建立舒服的開發環境

![](https://i.imgur.com/daE3T6T.jpg)


## 楔子
不知不覺也工作了半年了，每次上班還是會覺得非常充實。

寫程式的生活對我來說真的相當有成就感。有時候甚至會想要自己開發一些小東西來玩玩，比如自動交易機器人、健身用的倒數計時 APP 和課表記錄器、或是嘗試挑戰新的技術、新的概念。在過去的各種挑戰中，大部分都會失敗或是爛尾，但對我來說，學習本身比實際的結果更讓我感到滿足。

然而工作上的開發體驗，和自己獨立開發時的差距，常常讓我感到十分在意。

在工作上，因為已經有了各種環境建置，也有了各式的工具跟寫好的 script 可以跑，所以我只需要專注在意我所寫的元件有沒有寫好，其他的全部交給 script 就行了。

由於公司導入 typescript，我們的元件都是用 typescript 寫的，這對於有大量元件的 codebase 來說相當有幫助，因為這樣在重用元件的時候，就不用到處查看每個元件的 props 有什麼，或是應該傳入什麼樣的 type，這些都在開發該元件的時候，就已經定義清楚了。

另外，在 commit code 之前，也都會有 script 檢查程式碼的 convention、format、以及程式碼是否有 syntax error，以保證 codebase 的整潔跟一致性。

然而在我自己想開一個專案來玩的時候，卻少了很多這樣的環境設置。這造成的是開發體驗上的嚴重落差。什麼？為什麼程式沒有自己 format？為什麼沒有 type 可以看？怎麼都不會提示我的 syntax 是錯的？？？

這種相當差的開發體驗讓我深深體會到，用過好的開發體驗就真的回不去了 😆 我無法接受這種原始 (X) 的開發方式，我必須來好好處理開發環境！！


## 研究環境

再仔細研究公司的環境設定方式之後，發現了許多很實用的工具，而這些也是這次我要來學習的重點。而因為這篇文章的重點在於紀錄「如何設定環境」，因此我只簡單介紹各個套件，不多做解釋。
  - prettier
  - eslint
  - stylelint
  - typescript compiler
  - git-hooks
  - husky
  - lint-staged

## [Prettier](https://prettier.io/)
Prettier 應該是使用 vscode 的人基本上都會裝的一個 extension。顧名思義，`It makes your code prettier`。他對各種語言的支援度相當高，可以把程式碼的換行、空格、引號、分號、括號等等的格式統一，讓程式碼的格式變得乾淨整潔、不用再煩惱不同開發者不同的換行習慣，也不用擔心強迫症發作 :laughing: 

## [ESlint](https://eslint.org/)
相對於 Prettier 針對不同語言的「格式」上的修正，Eslint 在做的事情著重在 JavaScript 的語法上。根據 JavaScript 語言的各種寫法，他會標記出程式碼中「沒必要」或是「可能有問題」的語法，如果是可以直接被修正的問題，使用者也可以用一些設定讓 Eslint 執行的時候自動修正。

## [Stylelint](https://stylelint.io/)
stylelint 一樣是 linter 的一員，主要面向的是各種 css 語法。而隨著 postcss 和 CSS-in-JS 等技術的成熟，stylelint 也發展成為能夠很好的支援 styled-components、SCSS、SASS 語法的酷東西。

### [TypeScript Compiler (tsc)](https://www.typescriptlang.org/)
導入 TypeScript 對於開發上最大的差異，便是可以很快地知道元件本身應該接受什麼樣的資料，以及各種資料可能的型別。在有著大量元件或函式的時候相當有幫助，因為他可以大大減少我們來回翻程式碼的時間。

tsc 是導入 TypeScript 時會一起被導入的 cli 工具。TypeScript 實際上並不是一種新的語言，而是一種針對 JavaScript 的擴充，這種語言本身是沒辦法直接被編譯的，而必須透過 tsc 先編一成 JavaScript。在 compile 到 JavaScript 的時候，如果有任何型別上的問題，tsc 將會給出提示。

### [git-hooks](https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks)
git-hooks 是 git 的一個方便的工具，他可以讓開發者在執行 git command 的不同階段，執行 custom script。custom script 的語言沒有限制，只要是可執行檔，就可以被執行。

你可以用它來讓每次的 commit 都先跑過 linter，或是在 commit 的時候寄一封信到信箱，也可以在 push 上 remote branch 的時候自動更新 github 的狀態等等，是相當實用且強大的功能。


### [husky](https://typicode.github.io/husky/#/)
husky 是一個幫助我們輕鬆建立 hooks 的工具，可以幫我們省掉手動建立 git-hooks 的執行檔的麻煩。
***註***：其實在稍微研究了一下 git-hooks 的設定方式之後，發現 husky 只是讓我們可以用一行指令的方式幫我們建立 hook，實際上並沒有多太多的好處。

### [Lint-staged](https://github.com/okonet/lint-staged)
這個套件的主要功能是把各種 linter 打包，並且搭配 husky，在 commit 階段，執行一系列可以自定義的 lint script，讓檢查程式碼的整個過程完全自動化。

## 設定方式

### 專案建立
基本上用什麼框架都大同小異，只要已經做了 `git init` 和 `npm init (yarn init)`，專案有了 .git 和 package.json 兩個檔案之後，就可以繼續了。

### Prettier
1. 從 vscode extensions 下載 Prettier
2. 在專案的根目錄下新增 .prettierrc 檔案，裡面可以添加自己想要的格式規則。
```json
{
  "trailingComma": "es5",
  "tabWidth": 4,
  "semi": false,
  "singleQuote": true
}
```
- 其中，每個規則都可以單獨設定該規則要指定的 file，可以在 [options](https://prettier.io/docs/en/options.html) 看到所有的規則。
3. 或是也可以在 VSCode 的 settings.json 進行全域的設定，讓整個開發體驗更一致。
  1. 打開 VSCode，windows 輸入 Ctrl+Shift+p，mac 輸入 Cmd+Shift+p，輸入 settings.json 打開設定檔。
  ![](https://i.imgur.com/Xe1kXAp.png)

```json
  {
      "prettier": {
          "semi" : true,
          "tabSize": 2,
      }
  }
```

4. 另外可以開啟 VSCode format-on-save 或 format-on-paste 的功能，讓開發過程自動處理換行、分號等等與開發邏輯無關的任務。
![](https://i.imgur.com/cr66M2R.png)

### ESLint
1. `npm install eslint --save-dev` or `yarn add eslint --dev` 下載 eslint
2. 建立設定檔，可以直接建立一個 .eslintrc，或是使用 `npm init @eslint/config`(在已經有 package.json 的情況下才能用)
3. 和 prettier 類似的是，不同的規則都能夠獨立設定，並且可以設定格式錯誤時要如何顯示（warning / error）。規則定義在[這裡](https://eslint.org/docs/rules)

```json
{
    "rules": {
        "semi": ["error", "always"],
        "quotes": ["error", "double"]
    }
}
```
4. 同時使用 prettier 和 eslint，有時候會因為兩者的設定不同而 conflict，可以下載 [eslint-plugin-prettier](https://github.com/prettier/eslint-config-prettier) 來把 conflict 的設定關閉。
### Stylelint
1. 用法其實和 eslint 相當類似，就不多敘述了
2. `npm install --save-dev stylelint stylelint-config-standard`
3. 建立 .stylelintrc.json
```json
{
    "extends": "stylelint-config-standard"
}
```
### Typescript
1. `npm install typescript --save-dev`
2. 建立 tsconfig.json，在其中新增 compiler 設定、要進行 typecheck 的檔案等。
```json
{
  "compilerOptions": {
    "module": "system",
    "noImplicitAny": true,
    "removeComments": true,
    "preserveConstEnums": true,
    "outFile": "../../built/local/tsc.js",
    "sourceMap": true
  },
  "include": ["src/**/*"],
  "exclude": ["node_modules", "**/*.spec.ts"]
}
```

### lint staged
1. `npx mrm@2 lint-staged`
2. 這個指令會將目前在 package.json 中設定好的各種 linter, prettier 等工具整合，並下載 husky 來生成 pre-commit 的 git hook 

## 結語
做完這些設定後，基本上整個程式開發過程會多了很多的檢查工具，隨時提醒 coding style 的不一致，甚至是自動修正，讓開發體驗更好，也讓工程師可以更加專心在 feature 的開發，而不是慢慢尋找及修正各種換行、分號、括號漏掉的問題。

## 小 murmur
第一次寫這種工具類的文章，發現可以寫的東西太多了，一次性想介紹得太多，很不好抓要涵蓋的範圍以及深度，節奏上反而有點虎頭蛇尾。下次可能會把範圍寫得更小一點，花更多時間在細講其中的各種 tweak。



###### tags: 邊學邊工作